{% extends 'base.html' %}

{% block title %} Humano | Home {% endblock %}

{% block content %}

  {% if "user_id" in session %}
    <h2>Welcome, {{ user_name }}!</h2>
  {% endif %}

  <form>
    <input id="add-contact" class="btn" type="button" value="Add Contact" onclick="window.location.href='/add-contact'"/>
  </form>
  
  <!-- add logic: if user has a contact, show view-contacts -->
  {% if contacts %}
    <form>
      <input id="view-contacts" class="btn" type="button" value="View Contacts" onclick="window.location.href='/my-contacts'"/>
    </form>
  {% endif %}

  <!-- add if logic: if user has a message, show 'edit message' -->
  {% if message %}
    <form>
      <input id="view-message" class="btn" type="button" value="My Message" onclick="window.location.href='/view-message'"/>
    </form><br>
  {% else %}
    <form>
      <input id="add-message" class="btn" type="button" value="Add Message" onclick="window.location.href='/add-message'"/>
    </form>
  {% endif %}

  {% if message and contacts %}
    <button id="send-message-location" class="btn">SEND
    </button>
  {% endif %}

  <script type="text/javascript">
    // on click, this button will obtain the user's location and send the user's location and message to their contacts
    $("#send-message-location").on("click", function(evt){
      navigator.geolocation.getCurrentPosition(savePosition, errorHandler);
    });
    
    // // get user's location
    // function getLocation() {
    //     if (navigator.geolocation) {
    //         let location = navigator.geolocation.getCurrentPosition(savePosition, errorHandler)
    //         return location;
    //     } else { 
    //         alert("Sorry, your browser does not support geolocation services.");
    //     }
    // }

    function savePosition(position) {
      let userLocation = {
          "lat": position.coords.latitude,
          "lng": position.coords.longitude,
      };

      $.post("/send-message.json", 
             userLocation, 
             () => alert("Your message and location has been sent"),
      );
    }

   // report errors to user
    function errorHandler(error) {
     switch (error.code) {
      case error.PERMISSION_DENIED:
        alert("Could not get position as permission was denied.");
        break;
      case error.POSITION_UNAVAILABLE:
        alert("Could not get position as this information is not available at this time.");
        break;
       case error.TIMEOUT:
         alert("Attempt to get position timed out.");
        break;
       default:
        alert("Sorry, an error occurred. Code: " + error.code + " Message: " + error.message);
        break;
       }
    }

  </script>


{% endblock %}